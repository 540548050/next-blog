{"version":3,"file":"4.289266fd223ca494b1fe.hot-update.js","sources":["webpack:///pages/Blog/index.js"],"sourcesContent":["import React, {Component} from 'react'\nimport {connect} from 'react-redux'\nimport {\n  Layout, Menu, Breadcrumb, Row, Col,\n  List, Avatar, Icon, Pagination, Alert,\n  Input, Button, Radio, Tooltip, Spin\n} from 'antd'\n\nimport 'whatwg-fetch'\nimport Link from 'next/link';\nimport Head from 'next/head'\n\nimport {getSearchList, getSearchTotal, getSearchPageList} from '../../store/actions'\nimport Header from '../../components/Header';\nimport ListTitle from '../../components/ListTitle';\nimport Footer from '../../components/Footer';\nimport {getBlogUrl, getTotalUrl} from '../../config';\nimport {pageNum, TITLE, ALL} from '../../config/constantsData';\n\nconst {Content} = Layout;\nconst Search = Input.Search;\n\n\nclass Blog extends Component {\n  constructor() {\n    super()\n    this.state = {\n      currentPage: 1,\n      keyWard: ''\n    }\n  }\n\n  onSearch(val) {\n    const {dispatch} = this.props;\n    let queryStringObj, queryTotalString;\n    this.setState({\n      keyWard: val\n    })\n    if (val) {\n      queryStringObj = {\n        type: TITLE,\n        num: 1,\n        pageNum,\n        wd: val\n      }\n      queryTotalString = {\n        type: TITLE,\n        wd: val\n      };\n    } else {\n      queryStringObj = {\n        type: ALL,\n        num: 1,\n        pageNum\n      }\n      queryTotalString = {\n        type: ALL\n      };\n    }\n\n    getSearchList(dispatch, getBlogUrl(queryStringObj))\n    getSearchTotal(dispatch, getTotalUrl(queryTotalString))\n  }\n\n  onChange(page, pageSize) {\n    const {dispatch} = this.props\n    console.log('blog dispatch',this.props)\n    const {keyWard: wd} = this.state\n    this.setState({\n      currentPage: page\n    })\n\n    let {searchTotalData = []} = this.props;\n    if (searchTotalData.length) {\n      let queryStringObj = {\n        type: TITLE,\n        num: page,\n        pageNum,\n        wd\n      }\n      getSearchPageList(dispatch, getBlogUrl(queryStringObj))\n    }\n  }\n\n  itemRender(current, type, originalElement) {\n    if (type === 'prev') {\n      return <a>Previous</a>;\n    } else if (type === 'next') {\n      return <a>Next</a>;\n    }\n    return (\n      <Link as={`/Blog/${current}`} href={`/Blog?id=${current}`}>\n        <a>{current}</a>\n      </Link>\n    );\n  }\n\n  render() {\n    console.log(this.props)\n    let total;\n    let {pageBlogData = [], totalPageData = [], searchData = [], searchTotalData = []} = this.props;\n    //如果用户进行搜索，就用搜索的数据，这里为了用户体验，并没有服务端渲染\n    if (searchData.length) {\n      pageBlogData = searchData\n    }\n    if (searchTotalData.length) {\n      ({total} = searchTotalData[0] || {})\n    } else {\n      ({total} = totalPageData[0] || {})\n    }\n    return (\n      <div className=\"Blog\">\n        <Head>\n          <title>blog</title>\n        </Head>\n        <Header/>\n        <Layout>\n          <Content style={{padding: '0 50px'}}>\n            <div style={{padding: 24}}>\n\n              <Row gutter={16}>\n                <Col className=\"gutter-row\" span={22}>\n                  <Search placeholder=\"input search text\" onSearch={this.onSearch.bind(this)} enterButton=\"Search\"\n                          size=\"large\"/>\n                </Col>\n                <Col className=\"gutter-row\" span={2}>\n                  <Link href={`/PostArticle`}>\n                    <a>\n                      <Button size=\"large\" type=\"primary\">发布文章</Button>\n                    </a>\n                  </Link>\n                </Col>\n              </Row>\n            </div>\n            <div style={{background: '#fff', padding: 24, minHeight: 380}}>\n              <ListTitle listData={pageBlogData}/>\n\n              <Pagination total={total} itemRender={this.itemRender.bind(this)} onChange={this.onChange.bind(this)}/>\n            </div>\n          </Content>\n        </Layout>\n        <Footer/>\n      </div>\n    )\n  }\n}\n\nBlog.getInitialProps = async function (context) {\n  const {id = 1} = context.query\n  console.log(context.query)\n  let queryStringObj = {\n    type: ALL,\n    num: id,\n    pageNum\n  }\n  let queryTotalString = {type: ALL};\n  const pageBlog = await fetch(getBlogUrl(queryStringObj))\n  const totalPage = await fetch(getTotalUrl(queryTotalString))\n  const pageBlogData = await pageBlog.json()\n  const totalPageData = await totalPage.json()\n\n\n  return {pageBlogData, totalPageData}\n}\n//这里根据需要传入redux\nconst mapStateToProps = state => {\n  console.log(state)\n  const {res, searchData, searchTotalData} = state\n  return {res, searchData, searchTotalData};\n}\nexport default connect(mapStateToProps)(Blog)\n//export default Blog\n/*Blog.getInitialProps = async function ({ reduxStore, req}) {\n  const isServer = !!req\n  const blogData = await fetch('http://www.liuweibo.cn/getBlog?type=all&num=1&pageNum=10')\n  const blogDataJson = await blogData.json()\n  reduxStore.dispatch(serverRenderIncrementCount(isServer,blogDataJson))\n  return {}\n}\nconst mapStateToProps = state=>{\n  console.log(state)\n  const {res} = state\n  return {res};\n}\nexport default connect(mapStateToProps)(Blog)*/\n\n\n\n// WEBPACK FOOTER //\n// pages/Blog/index.js"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAOA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAFA;AAMA;AACA;;;AACA;AAAA;AAEA;AACA;AACA;AADA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AAEA;AAFA;AAIA;AACA;AADA;AAJA;AAAA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAGA;;;;AAzHA;AACA;AA2HA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAAA;AAAA;AARA;AAAA;AACA;AADA;AASA;AATA;AAAA;AACA;AADA;AAUA;AAVA;AAAA;AACA;AADA;AAWA;AAXA;AAAA;AACA;AADA;AAYA;AAZA;AAeA;AAAA;AAAA;AACA;AAhBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AAgBA;AACA;AADA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}