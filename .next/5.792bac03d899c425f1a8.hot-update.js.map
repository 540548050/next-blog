{"version":3,"file":"5.792bac03d899c425f1a8.hot-update.js","sources":["webpack:///components/Edit/index.js","webpack:///config/index.js","webpack:///until/index.js"],"sourcesContent":["import React, {Component} from 'react';\r\nimport {connect} from 'react-redux';\r\n\r\nimport {Row, Col} from 'antd';\r\n\r\nimport marked from 'marked'\r\nimport hljs from 'highlight.js';\r\n\r\n// import WangEdit from '../../components/WangEdit';\r\nimport {getHtml, OldTime} from '../../until';\r\nimport './test.less';\r\n\r\nhljs.configure({\r\n  tabReplace: '  ',\r\n  classPrefix: 'hljs-',\r\n  languages: ['CSS', 'HTML, XML', 'JavaScript', 'PHP', 'Python', 'Stylus', 'TypeScript', 'Markdown']\r\n})\r\nmarked.setOptions({\r\n  highlight: (code) => hljs.highlightAuto(code).value,\r\n  gfm: true,\r\n  tables: true,\r\n  breaks: false,\r\n  pedantic: false,\r\n  sanitize: true,\r\n  smartLists: true,\r\n  smartypants: false\r\n});\r\n\r\nclass Edit extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      previewContent: '',\r\n      aceBoxH: null,\r\n      originContent: ''\r\n\r\n    }\r\n\r\n    this.cacheValue()\r\n    this.containerScroll = this.containerScroll.bind(this)\r\n    this.onContentChange = this.onContentChange.bind(this)\r\n  }\r\n\r\n  componentWillMount() {\r\n    const {editCont = '', createTime = ''} = this.props;\r\n    let decodeOrigin = decodeURIComponent(editCont)\r\n    let markedContent = marked(decodeOrigin);\r\n    this.setState({\r\n      previewContent: markedContent,\r\n      originContent: decodeOrigin,\r\n    })\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setState({\r\n      aceBoxH: document.documentElement.clientHeight - document.querySelector('.editor-main-a').offsetHeight + 'px'\r\n    })\r\n  }\r\n\r\n  cacheValue() {\r\n    this.currentTabIndex = 1\r\n    this.hasContentChanged = false\r\n    this.scale = 1\r\n  }\r\n\r\n  setCurrentIndex(index) {\r\n    this.currentTabIndex = index\r\n  }\r\n\r\n  containerScroll(e) {\r\n    this.hasContentChanged && this.setScrollValue()\r\n    if (this.currentTabIndex === 1) {\r\n      this.previewContainer.scrollTop = this.editContainer.scrollTop * this.scale\r\n    } else {\r\n      this.editContainer.scrollTop = this.previewContainer.scrollTop / this.scale\r\n    }\r\n  }\r\n\r\n  onContentChange(e) {\r\n    let innerText = e.target.innerText\r\n    let markCont = marked(innerText)\r\n    const {handleChangeMarkEdit} = this.props;\r\n    handleChangeMarkEdit(innerText)\r\n    this.setState({\r\n      previewContent: markCont\r\n    })\r\n    !this.hasContentChanged && (this.hasContentChanged = true)\r\n  }\r\n\r\n  onOldArticleContentChange(e) {\r\n    const {handleChangeMarkEdit} = this.props;\r\n    handleChangeMarkEdit(e.target.innerHTML)\r\n  }\r\n\r\n  setScrollValue() {\r\n    // 设置值，方便 scrollBy 操作\r\n    this.scale = (this.previewWrap.offsetHeight - this.previewContainer.offsetHeight) / (this.editWrap.offsetHeight - this.editContainer.offsetHeight)\r\n    this.hasContentChanged = false\r\n  }\r\n\r\n  render() {\r\n\r\n    let {aceBoxH, previewContent, originContent} = this.state;\r\n    const {createTime = ''} = this.props;\r\n    return (\r\n      <div>\r\n        <div className=\"editor-main-a\" style={{height: aceBoxH}}\r\n             key='main'>\r\n          <Row>\r\n            {\r\n              createTime > OldTime || createTime === '' ?\r\n                <div>\r\n                  <Col span={12}>\r\n                    <div style={{height: aceBoxH}}>\r\n                      <div className=\"  content-edit\" onMouseOver={this.setCurrentIndex.bind(this, 1)}\r\n                           onScroll={this.containerScroll} ref={node => this.editContainer = node}>\r\n                        <div contentEditable=\"plaintext-only\"\r\n                             className=\"common-wrapper \" onInput={this.onContentChange}\r\n                             ref={node => this.editWrap = node}>\r\n                          {originContent}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <div>\r\n                      <div className=\"  content-edit\"\r\n                           ref={node => this.previewContainer = node}\r\n                           onMouseOver={this.setCurrentIndex.bind(this, 2)} onScroll={this.containerScroll}>\r\n                        <div className=\" common-wrapper\" ref={node => this.previewWrap = node}\r\n                             dangerouslySetInnerHTML={{__html: previewContent}}></div>\r\n                      </div>\r\n                    </div>\r\n                  </Col>\r\n                </div>\r\n                :\r\n                <Col span={24}>\r\n                  <div className=\"  content-edit\">\r\n                    <div className=\" common-wrapper\"\r\n                         contentEditable=\"plaintext-only\"\r\n                         onInput={this.onOldArticleContentChange.bind(this)}\r\n                         dangerouslySetInnerHTML={{__html: originContent}}></div>\r\n                  </div>\r\n                </Col>\r\n            }\r\n          </Row>\r\n\r\n        </div>\r\n        <style jsx>{`\r\n        .content-edit{\r\n          max-height:600px;\r\n          height:600px;\r\n          overflow-y:scroll;\r\n          border: 1px solid #ddd;\r\n          border-top:none;\r\n          background-color: #fff;\r\n        }\r\n.editor-main-a  .common-wrapper {\r\n  padding: 20px;\r\n  min-height: 100%;\r\n  outline: none;\r\n}\r\n\r\n\r\n        `}</style>\r\n      </div>\r\n\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default connect()(Edit);\n\n\n// WEBPACK FOOTER //\n// components/Edit/index.js","import {getDomain} from \"./env\";\r\nimport {toQueryStr} from '../until';\r\n\r\n//前台\r\nexport const getBlogUrl = (obj) => {\r\n  return getDomain() + 'api/getBlog' + toQueryStr(obj);\r\n}\r\nexport const getDetailUrl = (obj) => {\r\n  return getDomain() + 'api/detail' + toQueryStr(obj);\r\n}\r\nexport const getTotalUrl = (obj) => {\r\n  return getDomain() + 'api/total' + toQueryStr(obj);\r\n}\r\nexport const getLastIdUrl = (obj) => {\r\n  return getDomain() + 'api/lastId' + toQueryStr(obj);\r\n}\r\n\r\nexport const getNextIdUrl = (obj) => {\r\n  return getDomain() + 'api/nextId' + toQueryStr(obj);\r\n}\r\n\r\n\r\nexport const getCommentsUrl = (obj) => {\r\n  return getDomain() + 'api/comments' + toQueryStr(obj);\r\n}\r\nexport const postCommentUrl = () => {\r\n  return getDomain() + 'api/postComment';\r\n}\r\n\r\nexport const postArticleUrl = () => {\r\n  //发表文章\r\n  return getDomain() + 'api/postArticle';\r\n}\r\n\r\nexport const getLifeUrl = () => {\r\n  //生活板块\r\n  return getDomain() + 'api/life';\r\n}\r\n\r\n//后台\r\nexport const getAdminBlogUrl = (obj) => {\r\n  return getDomain() + 'api/getAdminBlog'+ toQueryStr(obj);\r\n}\r\nexport const postAdminDetailUrl = () => {\r\n  return getDomain() + 'api/postAdminDetail';\r\n}\r\n\r\n// export const getBlogUrl = domain+'/api/getBlog'\r\n// export const getTotalUrl = domain+'/api/total'\r\n// export const getLifeUrl = domain+'/api/life'\r\n// export const getDetailUrl = domain+'/api/detail'\r\n// export const getLastIdUrl = domain+'/api/lastId'\r\n// export const getNextIdUrl = domain+'/api/nextId'\r\n// export const getCommentsUrl = domain+'/api/comments'\r\n// export const postArticleUrl = domain+'/api/postArticle'\r\n// export const postCommentUrl = domain+'/api/postComment'\r\n\r\n\r\n// export const getAdminBlogUrl = domain + '/api/getAdminBlog'\r\n// export const getAdminCommentsUrl = domain + '/api/getAdminComments'\r\n// export const postAdminDetailUrl = domain + '/api/postAdminDetail'\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// config/index.js","\r\nlet format = require('date-format');\r\nexport const updateHtml=str=>{\r\n    return str.replace(/'|\"|:|\\.|\\[|\\]|\\\\/g,function(str){\r\n\r\n        if(str==='\"'){\r\n            return '@quot;'\r\n        }else if(str===\"'\") {\r\n            return '@apos;'\r\n        }else if(str===':') {\r\n            return  '&#58;'\r\n        }else if(str==='[') {\r\n            return  '&#91;'\r\n        }else if(str==='[') {\r\n            return  '&#93;'\r\n        }else if(str==='\\\\') {//自定义的 找不到\r\n            return  '&#43;'\r\n        }else {\r\n            return '&#183;'\r\n        }\r\n    });\r\n}\r\nexport const spaceAdd = str=>str&&str.replace(/\\+/g,'&nbsp;')\r\nexport const getPathName = props=>props.location&&props.location.pathname&&props.location.pathname.substring(1);\r\nexport const NbspToSpace = str=>str&&str.replace(/&nbsp;/g,'　')\r\nexport const formatTime = time=>{\r\n    let zh = [\"日\",\"一\",\"二\",\"三\",\"四\",\"五\",\"六\"];\r\n    let date = new Date(time*1000);\r\n    return format.asString('yyyy-MM-dd hh:mm', date)+' 星期'+zh[date.getDay()]\r\n}\r\nexport const getArticleInfo = detailArr=>{\r\n    let {...rest}=detailArr&&detailArr[0]?detailArr[0]:{};\r\n    /*{\r\n        content,\r\n            createTime,\r\n            id,\r\n            img,\r\n            lastModify,\r\n            like,\r\n            modifyCount,\r\n            recommend,\r\n            short,\r\n            title,\r\n            type,\r\n            url,\r\n            user,\r\n            visitor,\r\n            week\r\n    }*/\r\n    return rest\r\n}\r\nexport const OldTime = 1531094400;  // 2018-07-09 00:00:00 星期一\r\nexport const getHtml=(str,newTime)=>{\r\n    if(OldTime>newTime){ //这是曾经的文章\r\n        return str? str\r\n            :null\r\n    }else {\r\n        return str? str.replace(/@quot;|@apos;/g,function(str){\r\n                if(str==='@quot;'){\r\n                    return '\"'\r\n                }else if(str===\"@apos;\") {\r\n                    return \"'\"\r\n                }\r\n            })\r\n            :null\r\n    }\r\n}\r\nexport function toQueryStr(obj) {\r\n  return \"?\" + JSON.stringify(obj).replace(/{|}|\\\"|\\'/g, \"\").replace(/,/g, \"&\").replace(/:/g, \"=\");\r\n}\n\n\n// WEBPACK FOOTER //\n// until/index.js"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAIA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAHA;AAKA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AACA;AAUA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AACA;AAMA;AACA;AAAA;AACA;AAXA;AAYA;AACA;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAIA;;;AAEA;AACA;AACA;AADA;AAGA;;;AAEA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;;;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AAFA;AAIA;AACA;AACA;AADA;AAGA;AACA;;;AAEA;AAAA;AAEA;AACA;;;AAEA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAjCA;AAAA;AAAA;AA+DA;;;;AA5IA;AACA;AA+IA;;;;;;;;AC5KA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;;;;;;;;;;;;;;;;;;;AC3DA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;AAiBA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}