{"version":3,"file":"8.b2cd10ffe80532221d83.hot-update.js","sources":["webpack:///components/Edit/index.js"],"sourcesContent":["import React, {Component} from 'react';\r\nimport {connect} from 'react-redux';\r\n\r\nimport {Row, Col,Input} from 'antd';\r\n\r\nimport marked from 'marked'\r\nimport hljs from 'highlight.js';\r\n\r\nimport {getHtml, OldTime} from '../../until';\r\nimport './test.less';\r\n\r\nconst { TextArea } = Input;\r\n\r\nhljs.configure({\r\n  tabReplace: '  ',\r\n  classPrefix: 'hljs-',\r\n  languages: ['CSS', 'HTML, XML', 'JavaScript', 'PHP', 'Python', 'Stylus', 'TypeScript', 'Markdown']\r\n})\r\nmarked.setOptions({\r\n  highlight: (code) => hljs.highlightAuto(code).value,\r\n  gfm: true,\r\n  tables: true,\r\n  breaks: false,\r\n  pedantic: false,\r\n  sanitize: true,\r\n  smartLists: true,\r\n  smartypants: false\r\n});\r\n\r\nclass Edit extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      previewContent: '',\r\n      aceBoxH: null,\r\n      originContent: '',\r\n      inputValue:''\r\n\r\n    }\r\n\r\n    this.cacheValue()\r\n    this.containerScroll = this.containerScroll.bind(this)\r\n    this.onContentChange = this.onContentChange.bind(this)\r\n  }\r\n\r\n  componentWillMount() {\r\n    const {editCont = '', createTime = ''} = this.props;\r\n    let decodeOrigin = decodeURIComponent(editCont)\r\n    let markedContent = marked(decodeOrigin);\r\n    this.setState({\r\n      previewContent: markedContent,\r\n      originContent: decodeOrigin,\r\n    })\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setState({\r\n      aceBoxH: document.documentElement.clientHeight - document.querySelector('.editor-main-a').offsetHeight + 'px'\r\n    })\r\n  }\r\n\r\n  cacheValue() {\r\n    this.currentTabIndex = 1\r\n    this.hasContentChanged = false\r\n    this.scale = 1\r\n  }\r\n\r\n  setCurrentIndex(index) {\r\n    this.currentTabIndex = index\r\n  }\r\n\r\n  containerScroll(e) {\r\n    this.hasContentChanged && this.setScrollValue()\r\n    if (this.currentTabIndex === 1) {\r\n      this.previewContainer.scrollTop = this.editContainer.scrollTop * this.scale\r\n    } else {\r\n      this.editContainer.scrollTop = this.previewContainer.scrollTop / this.scale\r\n    }\r\n  }\r\n\r\n  onContentChange(e) {\r\n    let innerText = e.target.innerText\r\n    // let innerText = e.target.value\r\n    let markCont = marked(innerText)\r\n    const {handleChangeMarkEdit} = this.props;\r\n    handleChangeMarkEdit(innerText)\r\n    this.setState({\r\n      previewContent: markCont\r\n    })\r\n    !this.hasContentChanged && (this.hasContentChanged = true)\r\n  }\r\n\r\n  onOldArticleContentChange(e) {\r\n    const {handleChangeMarkEdit} = this.props;\r\n    handleChangeMarkEdit(e.target.innerHTML)\r\n  }\r\n\r\n  setScrollValue() {\r\n    // 设置值，方便 scrollBy 操作\r\n    this.scale = (this.previewWrap.offsetHeight - this.previewContainer.offsetHeight) / (this.editWrap.offsetHeight - this.editContainer.offsetHeight)\r\n    this.hasContentChanged = false\r\n  }\r\n\r\n  render() {\r\n\r\n    let {aceBoxH, previewContent, originContent} = this.state;\r\n    const {createTime = ''} = this.props;\r\n    return (\r\n      <div>\r\n        <div className=\"editor-main-a\" style={{height: aceBoxH}}\r\n             key='main'>\r\n          <Row>\r\n            {\r\n              createTime > OldTime || createTime === '' ?\r\n                <div>\r\n                  <Col span={12}>\r\n                    <div style={{height: aceBoxH}}>\r\n                      <div className=\"  content-edit\" onMouseOver={this.setCurrentIndex.bind(this, 1)}\r\n                           onScroll={this.containerScroll} ref={node => this.editContainer = node}>\r\n                        <div contentEditable=\"plaintext-only\"\r\n                             className=\"common-wrapper \" onInput={this.onContentChange}\r\n                             ref={node => this.editWrap = node}>\r\n                          {originContent}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <div>\r\n                      <div className=\"  content-edit\"\r\n                           ref={node => this.previewContainer = node}\r\n                           onMouseOver={this.setCurrentIndex.bind(this, 2)} onScroll={this.containerScroll}>\r\n                        <div className=\" common-wrapper\" ref={node => this.previewWrap = node}\r\n                             dangerouslySetInnerHTML={{__html: previewContent}}></div>\r\n                      </div>\r\n                    </div>\r\n                  </Col>\r\n                </div>\r\n                :\r\n                <div>\r\n                  <Col span={24}>\r\n                  <div className=\"  content-edit\">\r\n                    <div className=\" common-wrapper\"\r\n                         contentEditable=\"plaintext-only\"\r\n                         onInput={this.onOldArticleContentChange.bind(this)}\r\n                         dangerouslySetInnerHTML={{__html: originContent}}></div>\r\n                  </div>\r\n                </Col>\r\n                </div>\r\n            }\r\n          </Row>\r\n\r\n        </div>\r\n        <style jsx>{`\r\n        .content-edit{\r\n          max-height:600px;\r\n          height:600px;\r\n          overflow-y:auto;\r\n          border: 1px solid #ddd;\r\n          border-top:none;\r\n          background-color: #fff;\r\n        }\r\n.editor-main-a  .common-wrapper {\r\n  padding: 20px;\r\n  min-height: 100%;\r\n  outline: none;\r\n}\r\n        `}</style>\r\n      </div>\r\n\r\n    );\r\n  }\r\n\r\n}\r\n\r\nexport default connect()(Edit);\n\n\n// WEBPACK FOOTER //\n// components/Edit/index.js"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAIA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAHA;AAKA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AACA;AAUA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AACA;AAOA;AACA;AAAA;AACA;AAZA;AAaA;AACA;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAIA;;;AAEA;AACA;AACA;AADA;AAGA;;;AAEA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;;;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AADA;AAGA;AACA;;;AAEA;AAAA;AAEA;AACA;;;AAEA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAlCA;AAAA;AAAA;AA+DA;;;;AA9IA;AACA;AAiJA;;;;;;;A","sourceRoot":""}